!function(){"use strict";var e,t,n,r,o,i,u,s,l,a,c=tinymce.util.Tools.resolve("tinymce.PluginManager"),f=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),d=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),m=tinymce.util.Tools.resolve("tinymce.util.VK"),p=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),v=tinymce.util.Tools.resolve("tinymce.util.Tools"),g=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),h=function(e){return e&&"BR"===e.nodeName},y=function(e){return e&&3===e.nodeType},N=function(e){return e&&/^(OL|UL|DL)$/.test(e.nodeName)},S=function(e){return e&&/^(OL|UL)$/.test(e.nodeName)},O=function(e){return e&&/^(DT|DD)$/.test(e.nodeName)},C=function(e){return e&&/^(LI|DT|DD)$/.test(e.nodeName)},b=function(e){return e&&/^(TH|TD)$/.test(e.nodeName)},L=h,T=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},D=function(e,t){return e&&e.nodeName in t},E=function(e,t){return!!h(t)&&!(!e.isBlock(t.nextSibling)||h(t.previousSibling))},k=function(e,t,n){var r=e.isEmpty(t);return!(n&&0<e.select("span[data-mce-type=bookmark]",t).length)&&r},A=function(e,t){return e.isChildOf(t,e.getRoot())},w=function(e,t){if(y(e))return{container:e,offset:t};var n=f.getNode(e,t);return y(n)?{container:n,offset:t>=e.childNodes.length?n.data.length:0}:n.previousSibling&&y(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&y(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:e,offset:t}},x=function(e){var t=e.cloneRange(),n=w(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var r=w(e.endContainer,e.endOffset);return t.setEnd(r.container,r.offset),t},R=g.DOM,I=function(o){var i={},e=function(e){var t,n,r;n=o[e?"startContainer":"endContainer"],r=o[e?"startOffset":"endOffset"],1===n.nodeType&&(t=R.create("span",{"data-mce-type":"bookmark"}),n.hasChildNodes()?(r=Math.min(r,n.childNodes.length-1),e?n.insertBefore(t,n.childNodes[r]):R.insertAfter(t,n.childNodes[r])):n.appendChild(t),n=t,r=0),i[e?"startContainer":"endContainer"]=n,i[e?"startOffset":"endOffset"]=r};return e(!0),o.collapsed||e(),i},B=function(o){function e(e){var t,n,r;t=r=o[e?"startContainer":"endContainer"],n=o[e?"startOffset":"endOffset"],t&&(1===t.nodeType&&(n=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(t),t=t.parentNode,R.remove(r),!t.hasChildNodes()&&R.isBlock(t)&&t.appendChild(R.create("br"))),o[e?"startContainer":"endContainer"]=t,o[e?"startOffset":"endOffset"]=n)}e(!0),e();var t=R.createRng();return t.setStart(o.startContainer,o.startOffset),o.endContainer&&t.setEnd(o.endContainer,o.endOffset),x(t)},_=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),P=function(e){return function(){return e}},M=function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!n.apply(null,e)}},U=P(!1),F=P(!0),j=U,H=F,$=function(){return q},q=(r={fold:function(e,t){return e()},is:j,isSome:j,isNone:H,getOr:n=function(e){return e},getOrThunk:t=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){return undefined},or:n,orThunk:t,map:$,ap:$,each:function(){},bind:$,flatten:$,exists:j,forall:H,filter:$,equals:e=function(e){return e.isNone()},equals_:e,toArray:function(){return[]},toString:P("none()")},Object.freeze&&Object.freeze(r),r),W=function(n){var e=function(){return n},t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:H,isNone:j,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return W(e(n))},ap:function(e){return e.fold($,function(e){return W(e(n))})},each:function(e){e(n)},bind:r,flatten:e,exists:r,forall:r,filter:function(e){return e(n)?o:q},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(j,function(e){return t(n,e)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},z={some:W,none:$,from:function(e){return null===e||e===undefined?q:W(e)}},K=function(t){return function(e){return function(e){if(null===e)return"null";var t=typeof e;return"object"===t&&Array.prototype.isPrototypeOf(e)?"array":"object"===t&&String.prototype.isPrototypeOf(e)?"string":t}(e)===t}},X=K("string"),Q=K("boolean"),V=K("function"),Y=K("number"),G=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o,e)}return r},J=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n,e)},Z=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r,e)&&n.push(i)}return n},ee=function(e,t,n){return J(e,function(e){n=t(n,e)}),n},te=function(e,t){for(var n=0,r=e.length;n<r;n++){var o=e[n];if(t(o,n,e))return z.some(o)}return z.none()},ne=Array.prototype.push,re=function(e,t){return function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!Array.prototype.isPrototypeOf(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);ne.apply(t,e[n])}return t}(G(e,t))},oe=Array.prototype.slice,ie=function(e){return 0===e.length?z.none():z.some(e[0])},ue=function(e){return 0===e.length?z.none():z.some(e[e.length-1])},se=(V(Array.from)&&Array.from,function(e){var t=e.selection.getStart(!0);return e.dom.getParent(t,"OL,UL,DL",ce(e,t))}),ae=function(e){var n,t,r,o=e.selection.getSelectedBlocks();return v.grep((n=e,t=o,r=v.map(t,function(e){var t=n.dom.getParent(e,"li,dd,dt",ce(n,e));return t||e}),_.unique(r)),function(e){return C(e)})},ce=function(e,t){var n=e.dom.getParents(t,"TD,TH");return 0<n.length?n[0]:e.getBody()},fe=function(e,t){var n=e.dom.getParents(t,"ol,ul",ce(e,t));return ue(n)},le=function(t,e){var n=G(e,function(e){return fe(t,e).getOr(e)});return _.unique(n)},de={getParentList:se,getSelectedSubLists:function(e){var t,n,r,o=se(e),i=e.selection.getSelectedBlocks();return r=i,(n=o)&&1===r.length&&r[0]===n?(t=o,v.grep(t.querySelectorAll("ol,ul,dl"),function(e){return N(e)})):v.grep(i,function(e){return N(e)&&o!==e})},getSelectedListItems:ae,getClosestListRootElm:ce,getSelectedDlItems:function(e){return Z(ae(e),O)},getSelectedListRoots:function(e){var t,n,r,o=(n=fe(t=e,t.selection.getStart()),r=Z(t.selection.getSelectedBlocks(),S),n.toArray().concat(r));return le(e,o)}},me=("undefined"!=typeof window?window:Function("return this;")(),function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}return undefined}(e,t);if(!n)return{major:0,minor:0};var r=function(e){return Number(t.replace(n,"$"+e))};return pe(r(1),r(2))}),ge=function(){return pe(0,0)},pe=function(e,t){return{major:e,minor:t}},ve={nu:pe,detect:function(e,t){var n=String(t).toLowerCase();return 0===e.length?ge():me(e,n)},unknown:ge},he="Firefox",ye=function(e,t){return function(){return t===e}},Ne=function(e){var t=e.current;return{current:t,version:e.version,isEdge:ye("Edge",t),isChrome:ye("Chrome",t),isIE:ye("IE",t),isOpera:ye("Opera",t),isFirefox:ye(he,t),isSafari:ye("Safari",t)}},Se={unknown:function(){return Ne({current:undefined,version:ve.unknown()})},nu:Ne,edge:P("Edge"),chrome:P("Chrome"),ie:P("IE"),opera:P("Opera"),firefox:P(he),safari:P("Safari")},Oe="Windows",Ce="Android",be="Solaris",Le="FreeBSD",Te=function(e,t){return function(){return t===e}},De=function(e){var t=e.current;return{current:t,version:e.version,isWindows:Te(Oe,t),isiOS:Te("iOS",t),isAndroid:Te(Ce,t),isOSX:Te("OSX",t),isLinux:Te("Linux",t),isSolaris:Te(be,t),isFreeBSD:Te(Le,t)}},Ee={unknown:function(){return De({current:undefined,version:ve.unknown()})},nu:De,windows:P(Oe),ios:P("iOS"),android:P(Ce),linux:P("Linux"),osx:P("OSX"),solaris:P(be),freebsd:P(Le)},ke=function(e,t){var n=String(t).toLowerCase();return te(e,function(e){return e.search(n)})},Ae=function(e,n){return ke(e,n).map(function(e){var t=ve.detect(e.versionRegexes,n);return{current:e.name,version:t}})},we=function(e,n){return ke(e,n).map(function(e){var t=ve.detect(e.versionRegexes,n);return{current:e.name,version:t}})},xe=function(e,t){return-1!==e.indexOf(t)},Re=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Ie=function(t){return function(e){return xe(e,t)}},Be=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return xe(e,"edge/")&&xe(e,"chrome")&&xe(e,"safari")&&xe(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Re],search:function(e){return xe(e,"chrome")&&!xe(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return xe(e,"msie")||xe(e,"trident")}},{name:"Opera",versionRegexes:[Re,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Ie("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Ie("firefox")},{name:"Safari",versionRegexes:[Re,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(xe(e,"safari")||xe(e,"mobile/"))&&xe(e,"applewebkit")}}],_e=[{name:"Windows",search:Ie("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return xe(e,"iphone")||xe(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Ie("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Ie("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Ie("linux"),versionRegexes:[]},{name:"Solaris",search:Ie("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Ie("freebsd"),versionRegexes:[]}],Pe={browsers:P(Be),oses:P(_e)},Me=function(e){var t,n,r,o,i,u,s,a,c,f,l,d=Pe.browsers(),m=Pe.oses(),g=Ae(d,e).fold(Se.unknown,Se.nu),p=we(m,e).fold(Ee.unknown,Ee.nu);return{browser:g,os:p,deviceType:(n=g,r=e,o=(t=p).isiOS()&&!0===/ipad/i.test(r),i=t.isiOS()&&!o,u=t.isAndroid()&&3===t.version.major,s=t.isAndroid()&&4===t.version.major,a=o||u||s&&!0===/mobile/i.test(r),c=t.isiOS()||t.isAndroid(),f=c&&!a,l=n.isSafari()&&t.isiOS()&&!1===/safari/i.test(r),{isiPad:P(o),isiPhone:P(i),isTablet:P(a),isPhone:P(f),isTouch:P(c),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:P(l)})}},Ue={detect:(o=function(){var e=navigator.userAgent;return Me(e)},u=!1,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return u||(u=!0,i=o.apply(null,e)),i})},Fe=function(e){if(null===e||e===undefined)throw new Error("Node cannot be null or undefined");return{dom:P(e)}},je={fromHtml:function(e,t){var n=(t||document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||1<n.childNodes.length)throw console.error("HTML does not have a single root node",e),"HTML must have a single root node";return Fe(n.childNodes[0])},fromTag:function(e,t){var n=(t||document).createElement(e);return Fe(n)},fromText:function(e,t){var n=(t||document).createTextNode(e);return Fe(n)},fromDom:Fe,fromPoint:function(e,t,n){var r=e.dom();return z.from(r.elementFromPoint(t,n)).map(Fe)}},He=(Node.ATTRIBUTE_NODE,Node.CDATA_SECTION_NODE,Node.COMMENT_NODE,Node.DOCUMENT_NODE,Node.DOCUMENT_TYPE_NODE,Node.DOCUMENT_FRAGMENT_NODE,Node.ELEMENT_NODE),$e=(Node.TEXT_NODE,Node.PROCESSING_INSTRUCTION_NODE,Node.ENTITY_REFERENCE_NODE,Node.ENTITY_NODE,Node.NOTATION_NODE,He),qe=(Ue.detect().browser.isIE(),function(e,t){var n=e.dom();if(n.nodeType!==$e)return!1;if(n.matches!==undefined)return n.matches(t);if(n.msMatchesSelector!==undefined)return n.msMatchesSelector(t);if(n.webkitMatchesSelector!==undefined)return n.webkitMatchesSelector(t);if(n.mozMatchesSelector!==undefined)return n.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}),We=Object.keys,ze=function(e){return e.dom().nodeName.toLowerCase()},Ke=function(e,t){var n=e.dom();!function(e,t){for(var n=We(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i,e)}}(t,function(e,t){!function(e,t,n){if(!(X(n)||Q(n)||Y(n)))throw console.error("Invalid call to Attr.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")}(n,t,e)})},Xe=function(e){return ee(e.dom().attributes,function(e,t){return e[t.name]=t.value,e},{})},Qe=function(e){var t=e.dom();return z.from(t.parentNode).map(je.fromDom)},Ve=function(e){var t=e.dom();return G(t.childNodes,je.fromDom)},Ye=function(e,t){var n=e.dom().childNodes;return z.from(n[t]).map(je.fromDom)},Ge=function(e){return Ye(e,0)},Je=function(e){return Ye(e,e.dom().childNodes.length-1)},Ze=(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}("element","offset"),function(t,n){Qe(t).each(function(e){e.dom().insertBefore(n.dom(),t.dom())})}),et=function(e,t){e.dom().appendChild(t.dom())},tt=function(t,e){J(e,function(e){et(t,e)})},nt=function(e){var t=e.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},rt=function(e){return t=e,n=!0,je.fromDom(t.dom().cloneNode(n));var t,n},ot=function(e,t){var n,r,o,i,u=(n=e,r=t,o=je.fromTag(r),i=Xe(n),Ke(o,i),o);Ze(e,u);var s=Ve(e);return tt(u,s),nt(e),u},it=tinymce.util.Tools.resolve("tinymce.Env"),ut=g.DOM,st=function(e,t,n){var r,o,i,u=ut.createFragment(),s=e.schema.getBlockElements();if(e.settings.forced_root_block&&(n=n||e.settings.forced_root_block),n&&((o=ut.create(n)).tagName===e.settings.forced_root_block&&ut.setAttribs(o,e.settings.forced_root_block_attrs),D(t.firstChild,s)||u.appendChild(o)),t)for(;r=t.firstChild;){var a=r.nodeName;i||"SPAN"===a&&"bookmark"===r.getAttribute("data-mce-type")||(i=!0),D(r,s)?(u.appendChild(r),o=null):n?(o||(o=ut.create(n),u.appendChild(o)),o.appendChild(r)):u.appendChild(r)}return e.settings.forced_root_block?i||it.ie&&!(10<it.ie)||o.appendChild(ut.create("br",{"data-mce-bogus":"1"})):u.appendChild(ut.create("br")),u},at=g.DOM,ct=function(e,t,n,r){var o,i,u,s,a;for(u=at.select('span[data-mce-type="bookmark"]',t),r=r||st(e,n),(o=at.createRng()).setStartAfter(n),o.setEndAfter(t),s=(i=o.extractContents()).firstChild;s;s=s.firstChild)if("LI"===s.nodeName&&e.dom.isEmpty(s)){at.remove(s);break}e.dom.isEmpty(i)||at.insertAfter(i,t),at.insertAfter(r,t),k(e.dom,n.parentNode)&&(a=n.parentNode,v.each(u,function(e){a.parentNode.insertBefore(e,n.parentNode)}),at.remove(a)),at.remove(n),k(e.dom,t)&&at.remove(t)},ft=function(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r];if(!o.isSome())return z.none();n.push(o.getOrDie())}return z.some(t.apply(null,n))},lt=function(e,t,n){if(!X(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);e.style!==undefined&&e.style.setProperty(t,n)},dt=function(e,t){et(e.item,t.list)},mt=function(e,o){for(var i=[],t=function(e){var t,n,r=(t=o,n={list:je.fromTag(t),item:je.fromTag("li")},et(n.list,n.item),n);ue(i).each(function(e){return dt(e,r)}),i.push(r)},n=0;n<e;n++)t();return i},gt=function(e,a){var t=e.slice(0,a.depth);return ue(t).each(function(e){var t,n,r,o,i,u,s;t=e,r=a.itemAttributes,o=a.content,i=je.fromTag("li"),Ke(i,r),tt(i,o),n=i,et(t.list,n),t.item=n,s=a,ze((u=e).list).toUpperCase()!==s.listType&&(u.list=ot(u.list,s.listType)),Ke(u.list,s.listAttributes)}),t},pt=function(e,t){var n=mt(t.depth-e.length,t.listType);return function(e,t){ue(e).each(function(e){Ke(e.list,t.listAttributes),Ke(e.item,t.itemAttributes),tt(e.item,t.content)});for(var n=0;n<e.length-1;n++)r=e[n].item,o="list-style-type",i="none",u=r.dom(),lt(u,o,i);var r,o,i,u}(n,t),ft([ue(e),ie(n)],dt),e.concat(n)},vt=function(e){return 0<e.depth},ht=function(e){return e.isSelected},yt=Object.prototype.hasOwnProperty,Nt=(s=function(e,t){return t},function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(0===e.length)throw new Error("Can't merge zero objects");for(var n={},r=0;r<e.length;r++){var o=e[r];for(var i in o)yt.call(o,i)&&(n[i]=s(n[i],o[i]))}return n}),St=function(e,r){var t=r.depth-1;e[t].each(function(e){return n=e,(t=r).listType=n.listType,t.listAttributes=Nt({},n.listAttributes),void(t.itemAttributes=Nt({},n.itemAttributes));var t,n});var n=e.slice(0,t);return n.push(z.some(r)),n},Ot=function(e){ee(e,function(e,t){return t.depth>e.length?function(e,t){for(var n=e.slice(0),r=t.depth-e.length,o=1;o<r;o++)n.push(z.none());return n.push(z.some(t)),n}(e,t):St(e,t)},[])},Ct=function(e){var t=e,n=function(){return t};return{get:n,set:function(e){t=e},clone:function(){return Ct(n())}}};(a=l||(l={})).OL="OL",a.UL="UL",a.DL="DL";var bt=function(e){switch(ze(e)){case"ol":return z.some(l.OL);case"ul":return z.some(l.UL);case"dl":return z.some(l.DL);default:return z.none()}},Lt=function(e){return qe(e,"OL,UL,DL")},Tt=function(e){return Ge(e).map(Lt).getOr(!1)},Dt=function(e){var t=Ve(e),n=t.length+(Je(e).map(Lt).getOr(!1)?-1:0);return G(t.slice(0,n),rt)},Et=function(u,e,s,a){var c=function t(r){for(var o=[],e=1;e<arguments.length;e++)o[e-1]=arguments[e];return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=o.concat(e);return r.apply(null,n)}}(kt,u,e,s),f=function(r){return e.each(function(e){var t,n;t="Start"===r?e.start:e.end,n=a,t.dom()===n.dom()&&s.set("Start"===r)})};return Ge(a).filter(Lt).fold(function(){f("Start");var e,t,n,r,o=(e=a,t=u,n=s.get(),r=Qe(e),{depth:t,isSelected:n,content:Dt(e),listType:r.bind(bt).getOr(l.OL),listAttributes:r.map(Xe).getOr({}),itemAttributes:Xe(e)});f("End");var i=Je(a).filter(Lt).map(c).getOr([]);return[o].concat(i)},c)},kt=function(e,t,n,r){var o=e+1;return re(Ve(r),function(e){return Lt(e)?kt(o,t,n,e):Et(o,t,n,e)})},At=function(i,e){return G(e,function(e){var t,n,r,o=(t=e.content,r=(n||document).createDocumentFragment(),J(t,function(e){r.appendChild(e.dom())}),je.fromDom(r));return je.fromDom(st(i,o.dom()))})},wt=function(e){return Ot(e),(t=e,n=ee(t,function(e,t){return t.depth>e.length?pt(e,t):gt(e,t)},[]),ie(n).map(function(e){return e.list})).toArray();var t,n},xt=function(e){var t,n,r=G(de.getSelectedListItems(e),je.fromDom);return ft([te(r,M(Tt)),te((t=r,n=oe.call(t,0),n.reverse(),n),M(Tt))],function(e,t){return{start:e,end:t}})},Rt=function(s,e,a){var t,n,r,o=(t=e,n=xt(s),r=Ct(!1),G(t,function(e){return{entries:kt(0,n,r,e),sourceList:e}}));J(o,function(e){var t,n,r,o,i,u;t=e.entries,n=a,J(Z(t,ht),function(e){return function(e,t){switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}}(n,e)}),r=e.sourceList,i=s,u=e.entries,o=re(function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],o=[],i=0,u=e.length;i<u;i++){var s=e[i],a=t(s);a!==n&&(r.push(o),o=[]),n=a,o.push(s)}return 0!==o.length&&r.push(o),r}(u,vt),function(e){return ie(e).map(vt).getOr(!1)?wt(e):At(i,e)}),J(o,function(e){Ze(r,e)}),nt(e.sourceList)})},It=function(e){qe(e,"DT")&&ot(e,"DD")},Bt=function(r,e,t){J(t,"Indent"===e?It:function(e){return t=r,void(qe(n=e,"DD")?ot(n,"DT"):qe(n,"DT")&&Qe(n).each(function(e){return ct(t,e.dom(),n.dom())}));var t,n})},_t=function(e,t){var n=G(de.getSelectedDlItems(e),je.fromDom),r=G(de.getSelectedListRoots(e),je.fromDom);if(n.length||r.length){var o=e.selection.getBookmark();Bt(e,t,n),Rt(e,r,t),e.selection.moveToBookmark(o),e.selection.setRng(x(e.selection.getRng())),e.nodeChanged()}},Pt=function(e){_t(e,"Indent")},Mt=function(e){_t(e,"Outdent")},Ut=function(e){_t(e,"Flatten")},Ft=function(n,e){v.each(e,function(e,t){n.setAttribute(t,e)})},jt=function(e,t,n){var r,o,i,u,s,a,c;r=e,o=t,u=(i=n)["list-style-type"]?i["list-style-type"]:null,r.setStyle(o,"list-style-type",u),s=e,Ft(a=t,(c=n)["list-attributes"]),v.each(s.select("li",a),function(e){Ft(e,c["list-item-attributes"])})},Ht=function(e,t,n,r){var o,i;for(o=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"],1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&L(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(T(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},$t=function(f,l,d){void 0===d&&(d={});var e,t=f.selection.getRng(!0),m="LI",n=de.getClosestListRootElm(f,f.selection.getStart(!0)),g=f.dom;"false"!==g.getContentEditable(f.selection.getNode())&&("DL"===(l=l.toUpperCase())&&(m="DT"),e=I(t),v.each(function(n,e,r){for(var o,i=[],u=n.dom,t=Ht(n,e,!0,r),s=Ht(n,e,!1,r),a=[],c=t;c&&(a.push(c),c!==s);c=c.nextSibling);return v.each(a,function(e){if(T(n,e))return i.push(e),void(o=null);if(u.isBlock(e)||L(e))return L(e)&&u.remove(e),void(o=null);var t=e.nextSibling;p.isBookmarkNode(e)&&(T(n,t)||!t&&e.parentNode===r)?o=null:(o||(o=u.create("p"),e.parentNode.insertBefore(o,e),i.push(o)),o.appendChild(e))}),i}(f,t,n),function(e){var t,n,r,o,i,u,s,a,c;(n=e.previousSibling)&&N(n)&&n.nodeName===l&&(r=n,o=d,i=g.getStyle(r,"list-style-type"),u=o?o["list-style-type"]:"",i===(u=null===u?"":u))?(t=n,e=g.rename(e,m),n.appendChild(e)):(t=g.create(l),e.parentNode.insertBefore(t,e),t.appendChild(e),e=g.rename(e,m)),s=g,a=e,c=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],v.each(c,function(e){var t;return s.setStyle(a,((t={})[e]="",t))}),jt(g,t,d),Wt(f.dom,t)}),f.selection.setRng(B(e)))},qt=function(e,t,n){return a=n,(s=t)&&a&&N(s)&&s.nodeName===a.nodeName&&(i=t,u=n,(o=e).getStyle(i,"list-style-type",!0)===o.getStyle(u,"list-style-type",!0))&&(r=n,t.className===r.className);var r,o,i,u,s,a},Wt=function(e,t){var n,r;if(n=t.nextSibling,qt(e,t,n)){for(;r=n.firstChild;)t.appendChild(r);e.remove(n)}if(n=t.previousSibling,qt(e,t,n)){for(;r=n.lastChild;)t.insertBefore(r,t.firstChild);e.remove(n)}},zt=function(t,e,n,r,o){if(e.nodeName!==r||Kt(o)){var i=I(t.selection.getRng(!0));v.each([e].concat(n),function(e){!function(e,t,n,r){if(t.nodeName!==n){var o=e.rename(t,n);jt(e,o,r)}else jt(e,t,r)}(t.dom,e,r,o)}),t.selection.setRng(B(i))}else Ut(t)},Kt=function(e){return"list-style-type"in e},Xt={toggleList:function(e,t,n){var r=de.getParentList(e),o=de.getSelectedSubLists(e);n=n||{},r&&0<o.length?zt(e,r,o,t,n):function(e,t,n,r){if(t!==e.getBody())if(t)if(t.nodeName!==n||Kt(r)){var o=I(e.selection.getRng(!0));jt(e.dom,t,r),Wt(e.dom,e.dom.rename(t,n)),e.selection.setRng(B(o))}else Ut(e);else $t(e,n,r)}(e,r,t,n)},mergeWithAdjacentLists:Wt},Qt=g.DOM,Vt=function(e,t){var n,r=t.parentNode;"LI"===r.nodeName&&r.firstChild===t&&((n=r.previousSibling)&&"LI"===n.nodeName?(n.appendChild(t),k(e,r)&&Qt.remove(r)):Qt.setStyle(r,"listStyleType","none")),N(r)&&(n=r.previousSibling)&&"LI"===n.nodeName&&n.appendChild(t)},Yt=function(t,e){v.each(v.grep(t.select("ol,ul",e)),function(e){Vt(t,e)})},Gt=function(e,t,n,r){var o,i,u=t.startContainer,s=t.startOffset;if(3===u.nodeType&&(n?s<u.data.length:0<s))return u;for(o=e.schema.getNonEmptyElements(),1===u.nodeType&&(u=f.getNode(u,s)),i=new d(u,r),n&&E(e.dom,u)&&i.next();u=i[n?"next":"prev2"]();){if("LI"===u.nodeName&&!u.hasChildNodes())return u;if(o[u.nodeName])return u;if(3===u.nodeType&&0<u.data.length)return u}},Jt=function(e,t){var n=t.childNodes;return 1===n.length&&!N(n[0])&&e.isBlock(n[0])},Zt=function(e,t,n){var r,o,i,u;if(o=Jt(e,n)?n.firstChild:n,Jt(i=e,u=t)&&i.remove(u.firstChild,!0),!k(e,t,!0))for(;r=t.firstChild;)o.appendChild(r)},en=function(e,t,n){var r,o,i=t.parentNode;A(e,t)&&A(e,n)&&(N(n.lastChild)&&(o=n.lastChild),i===n.lastChild&&L(i.previousSibling)&&e.remove(i.previousSibling),(r=n.lastChild)&&L(r)&&t.hasChildNodes()&&e.remove(r),k(e,n,!0)&&e.$(n).empty(),Zt(e,t,n),o&&n.appendChild(o),e.remove(t),k(e,i)&&i!==e.getRoot()&&e.remove(i))},tn=function(e,t,n,r){var o,i,u,s=e.dom;if(s.isEmpty(r))i=n,u=r,(o=e).dom.$(u).empty(),en(o.dom,i,u),o.selection.setCursorLocation(u);else{var a=I(t);en(s,n,r),e.selection.setRng(B(a))}},nn=function(e,t){var n,r,o,i=e.dom,u=e.selection,s=u.getStart(),a=de.getClosestListRootElm(e,s),c=i.getParent(u.getStart(),"LI",a);if(c){if((n=c.parentNode)===e.getBody()&&k(i,n))return!0;if(r=x(u.getRng(!0)),(o=i.getParent(Gt(e,r,t,a),"LI",a))&&o!==c)return t?tn(e,r,o,c):function(e,t,n,r){var o=I(t);en(e.dom,n,r);var i=B(o);e.selection.setRng(i)}(e,r,c,o),!0;if(!o&&!t)return Ut(e),!0}return!1},rn=function(e,t){return nn(e,t)||function(o,i){var u=o.dom,e=o.selection.getStart(),s=de.getClosestListRootElm(o,e),a=u.getParent(e,u.isBlock,s);if(a&&u.isEmpty(a)){var t=x(o.selection.getRng(!0)),c=u.getParent(Gt(o,t,i,s),"LI",s);if(c)return o.undoManager.transact(function(){var e,t,n,r;t=a,n=s,r=(e=u).getParent(t.parentNode,e.isBlock,n),e.remove(t),r&&e.isEmpty(r)&&e.remove(r),Xt.mergeWithAdjacentLists(u,c.parentNode),o.selection.select(c,!0),o.selection.collapse(i)}),!0}return!1}(e,t)},on=function(e,t){return e.selection.isCollapsed()?rn(e,t):(r=(n=e).selection.getStart(),o=de.getClosestListRootElm(n,r),!!(n.dom.getParent(r,"LI,DT,DD",o)||0<de.getSelectedListItems(n).length)&&(n.undoManager.transact(function(){n.execCommand("Delete"),Yt(n.dom,n.getBody())}),!0));var n,r,o},un=function(t){t.on("keydown",function(e){e.keyCode===m.BACKSPACE?on(t,!1)&&e.preventDefault():e.keyCode===m.DELETE&&on(t,!0)&&e.preventDefault()})},sn=on,an=function(t){return{backspaceDelete:function(e){sn(t,e)}}},cn=function(t,n){return function(){var e=t.dom.getParent(t.selection.getStart(),"UL,OL,DL");return e&&e.nodeName===n}},fn=function(n){n.on("BeforeExecCommand",function(e){var t=e.command.toLowerCase();"indent"===t?Pt(n):"outdent"===t&&Mt(n)}),n.addCommand("InsertUnorderedList",function(e,t){Xt.toggleList(n,"UL",t)}),n.addCommand("InsertOrderedList",function(e,t){Xt.toggleList(n,"OL",t)}),n.addCommand("InsertDefinitionList",function(e,t){Xt.toggleList(n,"DL",t)}),n.addCommand("RemoveList",function(){Ut(n)}),n.addQueryStateHandler("InsertUnorderedList",cn(n,"UL")),n.addQueryStateHandler("InsertOrderedList",cn(n,"OL")),n.addQueryStateHandler("InsertDefinitionList",cn(n,"DL"))},ln=function(e){return e.getParam("lists_indent_on_tab",!0)},dn=function(e){var t;ln(e)&&(t=e).on("keydown",function(e){e.keyCode!==m.TAB||m.metaKeyPressed(e)||(e.preventDefault(),e.shiftKey?Mt(t):Pt(t))}),un(e)},mn=function(t,i){return function(o){var e=function(e){var t=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}(e.parents,b),n=-1!==t?e.parents.slice(0,t):e.parents,r=v.grep(n,N);o.setActive(0<r.length&&r[0].nodeName===i)};return t.on("NodeChange",e),function(){return t.off("NodeChange",e)}}},gn=function(t){var e,n,r,o=function(e){return function(){return t.execCommand(e)}};n="advlist",r=(e=t).settings.plugins?e.settings.plugins:"",-1===v.inArray(r.split(/[ ,]/),n)&&(t.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:o("InsertOrderedList"),onSetup:mn(t,"OL")}),t.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:o("InsertUnorderedList"),onSetup:mn(t,"UL")}))};c.add("lists",function(e){return dn(e),gn(e),fn(e),an(e)}),function pn(){}}();